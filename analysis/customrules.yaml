image:
  registry: gcr.io
  repository: ossf-malware-analysis/falco
  tag: 0.27.0-3
ebpf:
  enabled: true
docker:
  enabled: false # we use containerd
resources:
  requests:
    cpu: 500m
  limits:
    cpu: 1000m
falco:
  priority: CRITICAL
  httpOutput:
    enabled: true
    url: http://analysis.default/falco
  jsonOutput: true
  jsonIncludeOutputProperty: true
  syscallEventDrops:
    rate: 10
    maxBurst: 500
  bufferedOutputs: true
  outputs:
    rate: 10
    maxBurst: 10000
  webserver:
    enabled: false
customRules:
  rules-custom.yaml: |-
    - list: allowed_files
      items: [/etc/ld.so.cache, /etc/hosts, /usr/lib/ssl/openssl.cnf, /etc/nsswitch.conf, /etc/resolv.conf]
    - rule: Unexpected file access
      desc: Detect file access outside the workingdir
      condition: >
        (open_read and 
         not fd.name startswith /app/ and
         not fd.name startswith /tmp/ and
         not fd.name startswith /usr/local/lib/ and
         not fd.name startswith /usr/lib/ and
         not fd.name startswith /lib/ and
         not fd.name startswith /proc/ and
         not fd.name startswith /usr/lib/locale/ and
         not fd.name startswith /usr/include/c++ and
         not fd.name startswith /run/containerd/ and
         not fd.name startswith /usr/local/bundle/ and
         not fd.name startswith /usr/local/include/ruby-3.0.0/ and
         not fd.name in (allowed_files) and
         container and
         k8s.ns.name="default" and
         k8s.pod.label.install="1")
      output: unexpected file access (command=%proc.cmdline fd=%fd.name user=%user.name pod=%k8s.pod.name labels=%k8s.pod.labels)
      priority: CRITICAL

    - rule: Network connection
      desc: Detect network access
      condition: >
          (outbound and
           container and
           k8s.ns.name="default" and
           k8s.pod.label.install="1")
      output: network connection (command=%proc.cmdline ip=%fd.sip user=%user.name pod=%k8s.pod.name labels=%k8s.pod.labels)
      priority: CRITICAL
